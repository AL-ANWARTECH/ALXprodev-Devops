#!/bin/bash

# Directory where JSON files are stored
data_dir="pokemon_data"

# Output CSV file
report_file="pokemon_report.csv"

# Header for the CSV
echo "Name,Height (m),Weight (kg)" > "$report_file"

# Loop through all JSON files and extract data using jq
for file in "$data_dir"/*.json; do
    if [ -f "$file" ]; then
        name=$(jq -r '.name' "$file")
        height=$(jq -r '.height' "$file")
        weight=$(jq -r '.weight' "$file")

        # Convert height (decimeters -> meters) and weight (hectograms -> kg)
        height_m=$(awk "BEGIN {print $height/10}")
        weight_kg=$(awk "BEGIN {print $weight/10}")

        # Capitalize first letter of name
        name_cap=$(echo "$name" | awk '{print toupper(substr($0,1,1)) tolower(substr($0,2))}')

        echo "$name_cap,$height_m,$weight_kg" >> "$report_file"
    fi
done

# Print CSV report path
echo "CSV Report generated at: $report_file"
echo ""

# Display CSV content
cat "$report_file"

# Calculate averages using awk (skip header line)
awk -F',' 'NR>1 {h+=$2; w+=$3; c++} 
    END {printf "\nAverage Height: %.2f m\nAverage Weight: %.2f kg\n", h/c, w/c}' "$report_file"
